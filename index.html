<script type="module">
    const REPO_URL = "https://testachile.github.io/ModeloAR2/";
    const textureCache = {};
    
    async function loadTexture(textureName) {
        const textureUrl = `${REPO_URL}${textureName}`;
        if (!textureCache[textureUrl]) {
            try {
                console.log("Cargando textura:", textureUrl); // Debug
                const response = await fetch(textureUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const blob = await response.blob();
                textureCache[textureUrl] = await createImageBitmap(blob);
                console.log("Textura cargada con éxito:", textureName); // Debug
            } catch (error) {
                console.error("Error cargando textura:", error);
                return null;
            }
        }
        return textureCache[textureUrl];
    }

    async function changeTexture(textureName) {
        console.log("Intentando cambiar a textura:", textureName); // Debug
        const modelViewer = document.querySelector('#model-viewer');
        try {
            const model = await modelViewer.model;
            const texture = await loadTexture(textureName);
            
            if (!texture) {
                alert("Error: Textura no encontrada. Ver consola para detalles.");
                return;
            }

            model.materials.forEach((material, index) => {
                if (material.pbrMetallicRoughness) {
                    console.log(`Aplicando textura al material ${index}`); // Debug
                    material.pbrMetallicRoughness.baseColorTexture.setTexture(texture);
                }
            });
            console.log("¡Textura cambiada con éxito!"); // Debug
        } catch (error) {
            console.error("Error cambiando textura:", error);
        }
    }

    // Precargar texturas
    window.addEventListener('load', () => {
        loadTexture('Textura_platasuculenta.png');
        loadTexture('Textura_platasuculenta2.png');
    });
</script>
